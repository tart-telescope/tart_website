tart.elec.ac.nz {
        # Compress responses according to Accept-Encoding headers
        encode gzip zstd

        # Make HTML file extension optional
        try_files {path}.html {path}

        # Send API requests to backend
        rewrite /viewer /viewer/

        reverse_proxy /api/* host.docker.internal:9005

        route /viewer/* {
                reverse_proxy viewer:80
        }

        route /catalog/doc/* {
                uri strip_prefix /catalog/doc
                reverse_proxy host.docker.internal:8877
        }

        route /catalog/* {
                uri strip_prefix /catalog
                reverse_proxy host.docker.internal:8876
        }

        redir /signal/* /viewer/nz-elec
        redir /rhodes/* /viewer/za-rhodes

        redir /docs /doc permanent
        redir /docs/* /doc permanent
        redir /tart_website /doc
        redir /tart_website/ /doc


        root * /srv
        file_server
}

elec.ac.nz {
	redir https://www.{host}{uri}
}

www.elec.ac.nz {
	root * /elec_site
	file_server
}

